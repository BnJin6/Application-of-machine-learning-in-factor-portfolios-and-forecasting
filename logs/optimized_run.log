/Users/willieho/.matplotlib is not a writable directory
Matplotlib created a temporary cache directory at /var/folders/ww/rspvs9nj7n388qm6xzw82wpm0000gn/T/matplotlib-bu8urz9k because there was an issue with the default path (/Users/willieho/.matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
2025-11-05 10:06:56 - stock_prediction - INFO - ================================================================================
2025-11-05 10:06:56 - stock_prediction - INFO - 股票预测项目 - Alpha101因子量化预测
2025-11-05 10:06:56 - stock_prediction - INFO - ================================================================================
2025-11-05 10:06:56 - stock_prediction - INFO - 开始时间: 2025-11-05 10:06:56
2025-11-05 10:06:56 - stock_prediction - INFO - 运行配置:
2025-11-05 10:06:56 - stock_prediction - INFO -   数据文件: daily_data.csv
2025-11-05 10:06:56 - stock_prediction - INFO -   训练集截止日期: 2019-12-31
2025-11-05 10:06:56 - stock_prediction - INFO -   测试集起始日期: 2020-01-01
2025-11-05 10:06:56 - stock_prediction - INFO -   Alpha因子数量: 27
2025-11-05 10:06:56 - stock_prediction - INFO -   模型类型: ['LightGBM', 'XGBoost']
2025-11-05 10:06:56 - stock_prediction - INFO -   特征选择数量: 50
2025-11-05 10:06:56 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:06:56 - stock_prediction - INFO - 【步骤1】数据加载与预处理
2025-11-05 10:06:56 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:06:58 - stock_prediction - INFO - 原始数据 信息:
2025-11-05 10:06:58 - stock_prediction - INFO -   形状: (953712, 17)
2025-11-05 10:06:58 - stock_prediction - INFO -   列数: 17
2025-11-05 10:06:58 - stock_prediction - INFO -   行数: 953712
2025-11-05 10:06:59 - stock_prediction - INFO -   内存使用: 608.03 MB
2025-11-05 10:07:01 - stock_prediction - INFO - 预处理后数据 信息:
2025-11-05 10:07:01 - stock_prediction - INFO -   形状: (953692, 19)
2025-11-05 10:07:01 - stock_prediction - INFO -   列数: 19
2025-11-05 10:07:01 - stock_prediction - INFO -   行数: 953692
2025-11-05 10:07:01 - stock_prediction - INFO -   内存使用: 186.45 MB
2025-11-05 10:07:01 - stock_prediction - INFO - 训练集样本数: 547698
2025-11-05 10:07:01 - stock_prediction - INFO - 测试集样本数: 405626
2025-11-05 10:07:01 - stock_prediction - INFO - 训练集股票数: 659
2025-11-05 10:07:01 - stock_prediction - INFO - 测试集股票数: 524
2025-11-05 10:07:01 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:07:01 - stock_prediction - INFO - 【步骤2】特征工程
2025-11-05 10:07:01 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:07:01 - stock_prediction - INFO - 开始生成训练集特征...
2025-11-05 10:07:01 - stock_prediction - INFO - 计算Alpha因子: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 101]
2025-11-05 10:08:19 - stock_prediction - INFO - 训练集特征 信息:
2025-11-05 10:08:19 - stock_prediction - INFO -   形状: (547698, 63)
2025-11-05 10:08:19 - stock_prediction - INFO -   列数: 63
2025-11-05 10:08:19 - stock_prediction - INFO -   行数: 547698
2025-11-05 10:08:19 - stock_prediction - INFO -   内存使用: 290.94 MB
2025-11-05 10:08:19 - stock_prediction - INFO - 开始生成测试集特征...
2025-11-05 10:09:13 - stock_prediction - INFO - 测试集特征 信息:
2025-11-05 10:09:13 - stock_prediction - INFO -   形状: (405626, 63)
2025-11-05 10:09:13 - stock_prediction - INFO -   列数: 63
2025-11-05 10:09:13 - stock_prediction - INFO -   行数: 405626
2025-11-05 10:09:13 - stock_prediction - INFO -   内存使用: 215.47 MB
2025-11-05 10:09:13 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:09:13 - stock_prediction - INFO - 【步骤3】特征选择
2025-11-05 10:09:13 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:09:13 - stock_prediction - INFO - 移除y=0样本后，训练集样本数: 547698
2025-11-05 10:09:13 - stock_prediction - INFO - 初始特征数量: 51
2025-11-05 10:09:13 - stock_prediction - INFO - 移除高缺失率特征后，剩余 51 个特征
2025-11-05 10:09:14 - stock_prediction - INFO - 训练集大小: (547698, 51)
2025-11-05 10:09:14 - stock_prediction - INFO - 目标变量统计: 均值=-0.000059, 标准差=0.020448
2025-11-05 10:09:14 - stock_prediction - INFO - 开始特征选择...
2025-11-05 10:09:14 - stock_prediction - INFO - 移除低方差特征后: 47 个特征
2025-11-05 10:09:15 - stock_prediction - INFO - 移除高相关性特征后: 38 个特征
2025-11-05 10:09:15 - stock_prediction - INFO - 最终选择 38 个特征用于建模
2025-11-05 10:09:15 - stock_prediction - INFO - Top 10特征: ['alpha005', 'momentum_5', 'alpha011', 'momentum_20', 'momentum_10', 'alpha004', 'alpha013', 'alpha026', 'alpha016', 'alpha023']
2025-11-05 10:09:16 - stock_prediction - INFO - 
Top 5 特征相关性:
2025-11-05 10:09:16 - stock_prediction - INFO -   alpha005: 0.026651
2025-11-05 10:09:16 - stock_prediction - INFO -   momentum_5: 0.020935
2025-11-05 10:09:16 - stock_prediction - INFO -   alpha011: 0.019384
2025-11-05 10:09:16 - stock_prediction - INFO -   momentum_20: 0.017680
2025-11-05 10:09:16 - stock_prediction - INFO -   momentum_10: 0.016054
2025-11-05 10:09:16 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:09:16 - stock_prediction - INFO - 【步骤4】模型训练
2025-11-05 10:09:16 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:09:16 - stock_prediction - INFO - 训练集: (465543, 38), 验证集: (82155, 38)
2025-11-05 10:09:16 - stock_prediction - INFO - 训练集目标变量统计: 均值=-0.000080, 标准差=0.020141
2025-11-05 10:09:16 - stock_prediction - INFO - 验证集目标变量统计: 均值=0.000061, 标准差=0.022109
2025-11-05 10:09:16 - stock_prediction - INFO - ========================================
2025-11-05 10:09:16 - stock_prediction - INFO - 训练LightGBM模型...
2025-11-05 10:09:16 - stock_prediction - INFO - ========================================
  File "/Volumes/T7/opt/anaconda3/lib/python3.13/site-packages/joblib/externals/loky/backend/context.py", line 249, in _count_physical_cores
    cpu_count_physical = _count_physical_cores_darwin()
  File "/Volumes/T7/opt/anaconda3/lib/python3.13/site-packages/joblib/externals/loky/backend/context.py", line 318, in _count_physical_cores_darwin
    return int(cpu_info)
2025-11-05 10:09:22 - stock_prediction - INFO - 
LightGBM验证集评估:
2025-11-05 10:09:22 - stock_prediction - INFO - LightGBM性能指标:
2025-11-05 10:09:22 - stock_prediction - INFO -   MSE: 0.00048590489553690635
2025-11-05 10:09:22 - stock_prediction - INFO -   RMSE: 0.022043250566486476
2025-11-05 10:09:22 - stock_prediction - INFO -   MAE: 0.014517527478301904
2025-11-05 10:09:22 - stock_prediction - INFO -   Correlation: 0.07828209736851761
2025-11-05 10:09:22 - stock_prediction - INFO - 
LightGBM Top 10特征重要性:
2025-11-05 10:09:22 - stock_prediction - INFO -   momentum_10: 537.0000
2025-11-05 10:09:22 - stock_prediction - INFO -   momentum_20: 532.0000
2025-11-05 10:09:22 - stock_prediction - INFO -   returns: 503.0000
2025-11-05 10:09:22 - stock_prediction - INFO -   price_position: 500.0000
2025-11-05 10:09:22 - stock_prediction - INFO -   momentum_5: 480.0000
2025-11-05 10:09:22 - stock_prediction - INFO -   turnover_rate_rank: 479.0000
2025-11-05 10:09:22 - stock_prediction - INFO -   market_cap_rank: 394.0000
2025-11-05 10:09:22 - stock_prediction - INFO -   alpha011: 390.0000
2025-11-05 10:09:22 - stock_prediction - INFO -   alpha023: 390.0000
2025-11-05 10:09:22 - stock_prediction - INFO -   alpha020: 389.0000
2025-11-05 10:09:22 - stock_prediction - INFO - 
========================================
2025-11-05 10:09:22 - stock_prediction - INFO - 训练XGBoost模型...
2025-11-05 10:09:22 - stock_prediction - INFO - ========================================
2025-11-05 10:09:26 - stock_prediction - INFO - 
XGBoost验证集评估:
2025-11-05 10:09:26 - stock_prediction - INFO - XGBoost性能指标:
2025-11-05 10:09:26 - stock_prediction - INFO -   MSE: 0.0004885867045841442
2025-11-05 10:09:26 - stock_prediction - INFO -   RMSE: 0.022103997479735293
2025-11-05 10:09:26 - stock_prediction - INFO -   MAE: 0.014567225914209897
2025-11-05 10:09:26 - stock_prediction - INFO -   Correlation: 0.05704650834698458
2025-11-05 10:09:26 - stock_prediction - INFO - 
XGBoost Top 10特征重要性:
2025-11-05 10:09:26 - stock_prediction - INFO -   volume_rank: 0.4067
2025-11-05 10:09:26 - stock_prediction - INFO -   momentum_5: 0.3000
2025-11-05 10:09:26 - stock_prediction - INFO -   returns: 0.2933
2025-11-05 10:09:26 - stock_prediction - INFO -   alpha101: 0.0000
2025-11-05 10:09:26 - stock_prediction - INFO -   alpha006: 0.0000
2025-11-05 10:09:26 - stock_prediction - INFO -   alpha009: 0.0000
2025-11-05 10:09:26 - stock_prediction - INFO -   alpha003: 0.0000
2025-11-05 10:09:26 - stock_prediction - INFO -   alpha017: 0.0000
2025-11-05 10:09:26 - stock_prediction - INFO -   alpha020: 0.0000
2025-11-05 10:09:26 - stock_prediction - INFO -   market_cap_rank: 0.0000
2025-11-05 10:09:26 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:09:26 - stock_prediction - INFO - 【步骤5】模型集成
2025-11-05 10:09:26 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:09:26 - stock_prediction - INFO - 已添加2个模型到集成器
2025-11-05 10:09:26 - stock_prediction - INFO - 
集成模型验证集评估:
2025-11-05 10:09:26 - stock_prediction - INFO - 集成模型性能指标:
2025-11-05 10:09:26 - stock_prediction - INFO -   MSE: 0.00048629181038187643
2025-11-05 10:09:26 - stock_prediction - INFO -   RMSE: 0.02205202508573479
2025-11-05 10:09:26 - stock_prediction - INFO -   MAE: 0.01452708642666638
2025-11-05 10:09:26 - stock_prediction - INFO -   Correlation: 0.07935086480691395
2025-11-05 10:09:26 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:09:26 - stock_prediction - INFO - 【步骤6】测试集预测
2025-11-05 10:09:26 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:09:26 - stock_prediction - INFO - 测试集大小: (405626, 38)
2025-11-05 10:09:26 - stock_prediction - INFO - 测试集日期范围: 2020-01-02 15:00:00 至 2023-11-15 15:00:00
2025-11-05 10:09:26 - stock_prediction - INFO - 开始预测...
2025-11-05 10:09:27 - stock_prediction - INFO - 预测值统计: 均值=-0.000092, 标准差=0.000950
2025-11-05 10:09:27 - stock_prediction - INFO - 预测值范围: [-0.019413, 0.023126]
2025-11-05 10:09:28 - stock_prediction - INFO - 预测结果已保存到: predictions.csv
2025-11-05 10:09:28 - stock_prediction - INFO - 预测样本数: 405626
2025-11-05 10:09:28 - stock_prediction - INFO - 预测结果统计:
2025-11-05 10:09:28 - stock_prediction - INFO -   预测样本数: 405626
2025-11-05 10:09:28 - stock_prediction - INFO -   预测股票数: 524
2025-11-05 10:09:28 - stock_prediction - INFO -   预测日期数: 938
2025-11-05 10:09:28 - stock_prediction - INFO -   预测值均值: -9.203877427715005e-05
2025-11-05 10:09:28 - stock_prediction - INFO -   预测值标准差: 0.0009501909299800135
2025-11-05 10:09:28 - stock_prediction - INFO -   预测值最小值: -0.019412603339737374
2025-11-05 10:09:28 - stock_prediction - INFO -   预测值最大值: 0.023125832627317384
2025-11-05 10:09:28 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:09:28 - stock_prediction - INFO - 【步骤7】保存模型
2025-11-05 10:09:28 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 10:09:28 - stock_prediction - INFO - LightGBM模型已保存到: models/lgb_model.pkl
2025-11-05 10:09:28 - stock_prediction - INFO - XGBoost模型已保存到: models/xgb_model.pkl
2025-11-05 10:09:28 - stock_prediction - INFO - 特征列表已保存到: models/feature_list.pkl
2025-11-05 10:09:28 - stock_prediction - INFO - 运行摘要已保存到: logs/run_summary.json
2025-11-05 10:09:28 - stock_prediction - INFO - ================================================================================
2025-11-05 10:09:28 - stock_prediction - INFO - 【步骤8】结果总结
2025-11-05 10:09:28 - stock_prediction - INFO - ================================================================================
2025-11-05 10:09:28 - stock_prediction - INFO - 
模型性能对比:
2025-11-05 10:09:28 - stock_prediction - INFO -   LightGBM Correlation: 0.078282
2025-11-05 10:09:28 - stock_prediction - INFO -   XGBoost Correlation: 0.057047
2025-11-05 10:09:28 - stock_prediction - INFO -   Ensemble Correlation: 0.079351
2025-11-05 10:09:28 - stock_prediction - INFO - 
最佳模型: Ensemble
2025-11-05 10:09:28 - stock_prediction - INFO - 
结束时间: 2025-11-05 10:09:28
2025-11-05 10:09:28 - stock_prediction - INFO - ================================================================================
2025-11-05 10:09:28 - stock_prediction - INFO - 项目完成!
2025-11-05 10:09:28 - stock_prediction - INFO - ================================================================================
2025-11-05 10:09:28 - stock_prediction - INFO - 
详细日志已保存到: logs/stock_prediction_20251105_100656.log
正在加载数据: daily_data.csv
尝试直接加载...
直接加载失败: 'utf-8' codec can't decode byte 0x8b in position 0: invalid start byte
尝试使用latin1编码...
数据加载完成，共 953712 条记录（latin1编码）
警告: 发现 20 行日期无效，将被移除
数据预处理完成
训练集: 547698 条记录 (截止 2019-12-31)
测试集: 405626 条记录 (从 2020-01-01 开始)
开始生成技术指标特征...
技术指标特征生成完成
开始生成Alpha101因子...
正在计算 alpha001...
正在计算 alpha002...
正在计算 alpha003...
正在计算 alpha004...
正在计算 alpha005...
正在计算 alpha006...
正在计算 alpha007...
正在计算 alpha008...
正在计算 alpha009...
正在计算 alpha010...
正在计算 alpha011...
正在计算 alpha012...
正在计算 alpha013...
正在计算 alpha014...
正在计算 alpha015...
正在计算 alpha016...
正在计算 alpha017...
正在计算 alpha018...
正在计算 alpha019...
正在计算 alpha020...
正在计算 alpha021...
正在计算 alpha022...
正在计算 alpha023...
正在计算 alpha024...
正在计算 alpha025...
正在计算 alpha026...
正在计算 alpha101...
Alpha因子生成完成，共 27 个因子
所有特征生成完成，共 63 列
开始生成技术指标特征...
技术指标特征生成完成
开始生成Alpha101因子...
正在计算 alpha001...
正在计算 alpha002...
正在计算 alpha003...
正在计算 alpha004...
正在计算 alpha005...
正在计算 alpha006...
正在计算 alpha007...
正在计算 alpha008...
正在计算 alpha009...
正在计算 alpha010...
正在计算 alpha011...
正在计算 alpha012...
正在计算 alpha013...
正在计算 alpha014...
正在计算 alpha015...
正在计算 alpha016...
正在计算 alpha017...
正在计算 alpha018...
正在计算 alpha019...
正在计算 alpha020...
正在计算 alpha021...
正在计算 alpha022...
正在计算 alpha023...
正在计算 alpha024...
正在计算 alpha025...
正在计算 alpha026...
正在计算 alpha101...
Alpha因子生成完成，共 27 个因子
所有特征生成完成，共 63 列
移除低方差特征后，剩余 47 个特征
移除高相关性特征后，剩余 38 个特征
根据correlation选择了 38 个特征
开始训练 lightgbm 模型...
训练集大小: (465543, 38)
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[198]	valid_0's rmse: 0.0220433
模型训练完成

模型评估结果:
MSE: 0.000486
RMSE: 0.022043
MAE: 0.014518
Correlation: 0.078282

特征重要性 (Top 20):
               feature  importance
4          momentum_10         537
3          momentum_20         532
37             returns         503
30      price_position         500
1           momentum_5         480
17  turnover_rate_rank         479
26     market_cap_rank         394
2             alpha011         390
9             alpha023         390
25            alpha020         389
22            alpha009         380
27            alpha101         379
0             alpha005         360
36            alpha012         354
11            alpha001         339
19            alpha010         337
31         volume_rank         313
13            alpha018         309
8             alpha016         308
34                high         306
开始训练 xgboost 模型...
训练集大小: (465543, 38)
模型训练完成

模型评估结果:
MSE: 0.000489
RMSE: 0.022104
MAE: 0.014567
Correlation: 0.057047

特征重要性 (Top 20):
            feature  importance
31      volume_rank    0.406671
1        momentum_5    0.299993
37          returns    0.293336
27         alpha101    0.000000
21         alpha006    0.000000
22         alpha009    0.000000
23         alpha003    0.000000
24         alpha017    0.000000
25         alpha020    0.000000
26  market_cap_rank    0.000000
29         alpha019    0.000000
28         alpha025    0.000000
30   price_position    0.000000
32         alpha022    0.000000
33       volume_ma5    0.000000
34             high    0.000000
35           volume    0.000000
36         alpha012    0.000000
20         alpha014    0.000000
0          alpha005    0.000000

集成模型评估结果 (average):
MSE: 0.000486
RMSE: 0.022052
MAE: 0.014527
Correlation: 0.079351
模型已保存到: models/lgb_model.pkl
模型已保存到: models/xgb_model.pkl
