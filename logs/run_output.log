/Users/willieho/.matplotlib is not a writable directory
Matplotlib created a temporary cache directory at /var/folders/ww/rspvs9nj7n388qm6xzw82wpm0000gn/T/matplotlib-2xhbyp2y because there was an issue with the default path (/Users/willieho/.matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
2025-11-05 09:45:24 - stock_prediction - INFO - ================================================================================
2025-11-05 09:45:24 - stock_prediction - INFO - 股票预测项目 - Alpha101因子量化预测
2025-11-05 09:45:24 - stock_prediction - INFO - ================================================================================
2025-11-05 09:45:24 - stock_prediction - INFO - 开始时间: 2025-11-05 09:45:24
2025-11-05 09:45:24 - stock_prediction - INFO - 运行配置:
2025-11-05 09:45:24 - stock_prediction - INFO -   数据文件: daily_data.csv
2025-11-05 09:45:24 - stock_prediction - INFO -   训练集截止日期: 2019-12-31
2025-11-05 09:45:24 - stock_prediction - INFO -   测试集起始日期: 2020-01-01
2025-11-05 09:45:24 - stock_prediction - INFO -   Alpha因子数量: 27
2025-11-05 09:45:24 - stock_prediction - INFO -   模型类型: ['LightGBM', 'XGBoost']
2025-11-05 09:45:24 - stock_prediction - INFO -   特征选择数量: 50
2025-11-05 09:45:24 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:45:24 - stock_prediction - INFO - 【步骤1】数据加载与预处理
2025-11-05 09:45:24 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:45:27 - stock_prediction - INFO - 原始数据 信息:
2025-11-05 09:45:27 - stock_prediction - INFO -   形状: (953712, 17)
2025-11-05 09:45:27 - stock_prediction - INFO -   列数: 17
2025-11-05 09:45:27 - stock_prediction - INFO -   行数: 953712
2025-11-05 09:45:28 - stock_prediction - INFO -   内存使用: 608.03 MB
2025-11-05 09:45:29 - stock_prediction - INFO - 预处理后数据 信息:
2025-11-05 09:45:29 - stock_prediction - INFO -   形状: (953692, 19)
2025-11-05 09:45:29 - stock_prediction - INFO -   列数: 19
2025-11-05 09:45:29 - stock_prediction - INFO -   行数: 953692
2025-11-05 09:45:29 - stock_prediction - INFO -   内存使用: 186.45 MB
2025-11-05 09:45:30 - stock_prediction - INFO - 训练集样本数: 547698
2025-11-05 09:45:30 - stock_prediction - INFO - 测试集样本数: 405626
2025-11-05 09:45:30 - stock_prediction - INFO - 训练集股票数: 659
2025-11-05 09:45:30 - stock_prediction - INFO - 测试集股票数: 524
2025-11-05 09:45:30 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:45:30 - stock_prediction - INFO - 【步骤2】特征工程
2025-11-05 09:45:30 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:45:30 - stock_prediction - INFO - 开始生成训练集特征...
2025-11-05 09:45:30 - stock_prediction - INFO - 计算Alpha因子: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 101]
2025-11-05 09:46:50 - stock_prediction - INFO - 训练集特征 信息:
2025-11-05 09:46:50 - stock_prediction - INFO -   形状: (547698, 63)
2025-11-05 09:46:50 - stock_prediction - INFO -   列数: 63
2025-11-05 09:46:50 - stock_prediction - INFO -   行数: 547698
2025-11-05 09:46:51 - stock_prediction - INFO -   内存使用: 290.94 MB
2025-11-05 09:46:51 - stock_prediction - INFO - 开始生成测试集特征...
2025-11-05 09:47:48 - stock_prediction - INFO - 测试集特征 信息:
2025-11-05 09:47:48 - stock_prediction - INFO -   形状: (405626, 63)
2025-11-05 09:47:48 - stock_prediction - INFO -   列数: 63
2025-11-05 09:47:48 - stock_prediction - INFO -   行数: 405626
2025-11-05 09:47:48 - stock_prediction - INFO -   内存使用: 215.47 MB
2025-11-05 09:47:48 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:47:48 - stock_prediction - INFO - 【步骤3】特征选择
2025-11-05 09:47:48 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:47:48 - stock_prediction - INFO - 移除y=0样本后，训练集样本数: 547698
2025-11-05 09:47:48 - stock_prediction - INFO - 初始特征数量: 51
2025-11-05 09:47:48 - stock_prediction - INFO - 移除高缺失率特征后，剩余 51 个特征
2025-11-05 09:47:49 - stock_prediction - INFO - 训练集大小: (547698, 51)
2025-11-05 09:47:49 - stock_prediction - INFO - 目标变量统计: 均值=-0.000059, 标准差=0.020448
2025-11-05 09:47:49 - stock_prediction - INFO - 开始特征选择...
2025-11-05 09:47:49 - stock_prediction - INFO - 移除低方差特征后: 46 个特征
2025-11-05 09:47:50 - stock_prediction - INFO - 移除高相关性特征后: 37 个特征
2025-11-05 09:47:50 - stock_prediction - INFO - 最终选择 37 个特征用于建模
2025-11-05 09:47:50 - stock_prediction - INFO - Top 10特征: ['alpha005', 'momentum_5', 'alpha011', 'momentum_20', 'momentum_10', 'alpha004', 'alpha013', 'alpha026', 'alpha016', 'alpha023']
2025-11-05 09:47:50 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:47:50 - stock_prediction - INFO - 【步骤4】模型训练
2025-11-05 09:47:50 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:47:50 - stock_prediction - INFO - 训练集: (438158, 37), 验证集: (109540, 37)
2025-11-05 09:47:50 - stock_prediction - INFO - ========================================
2025-11-05 09:47:50 - stock_prediction - INFO - 训练LightGBM模型...
2025-11-05 09:47:50 - stock_prediction - INFO - ========================================
  File "/Volumes/T7/opt/anaconda3/lib/python3.13/site-packages/joblib/externals/loky/backend/context.py", line 249, in _count_physical_cores
    cpu_count_physical = _count_physical_cores_darwin()
  File "/Volumes/T7/opt/anaconda3/lib/python3.13/site-packages/joblib/externals/loky/backend/context.py", line 318, in _count_physical_cores_darwin
    return int(cpu_info)
2025-11-05 09:47:52 - stock_prediction - INFO - 
LightGBM验证集评估:
2025-11-05 09:47:52 - stock_prediction - INFO - LightGBM性能指标:
2025-11-05 09:47:52 - stock_prediction - INFO -   MSE: 0.0004944325859579155
2025-11-05 09:47:52 - stock_prediction - INFO -   RMSE: 0.022235840122601967
2025-11-05 09:47:52 - stock_prediction - INFO -   MAE: 0.014572730236323087
2025-11-05 09:47:52 - stock_prediction - INFO -   Correlation: 0.0729675893510763
2025-11-05 09:47:52 - stock_prediction - INFO - 
LightGBM Top 10特征重要性:
2025-11-05 09:47:52 - stock_prediction - INFO -   momentum_20: 127.0000
2025-11-05 09:47:52 - stock_prediction - INFO -   price_position: 121.0000
2025-11-05 09:47:52 - stock_prediction - INFO -   momentum_5: 100.0000
2025-11-05 09:47:52 - stock_prediction - INFO -   alpha009: 94.0000
2025-11-05 09:47:52 - stock_prediction - INFO -   alpha011: 87.0000
2025-11-05 09:47:52 - stock_prediction - INFO -   momentum_10: 86.0000
2025-11-05 09:47:52 - stock_prediction - INFO -   alpha101: 85.0000
2025-11-05 09:47:52 - stock_prediction - INFO -   turnover_rate_rank: 83.0000
2025-11-05 09:47:52 - stock_prediction - INFO -   high: 83.0000
2025-11-05 09:47:52 - stock_prediction - INFO -   alpha020: 83.0000
2025-11-05 09:47:52 - stock_prediction - INFO - 
========================================
2025-11-05 09:47:52 - stock_prediction - INFO - 训练XGBoost模型...
2025-11-05 09:47:52 - stock_prediction - INFO - ========================================
2025-11-05 09:47:56 - stock_prediction - INFO - 
XGBoost验证集评估:
2025-11-05 09:47:56 - stock_prediction - INFO - XGBoost性能指标:
2025-11-05 09:47:56 - stock_prediction - INFO -   MSE: 0.0004942794561103583
2025-11-05 09:47:56 - stock_prediction - INFO -   RMSE: 0.02223239654446543
2025-11-05 09:47:56 - stock_prediction - INFO -   MAE: 0.014569729364672587
2025-11-05 09:47:56 - stock_prediction - INFO -   Correlation: 0.07493682706394669
2025-11-05 09:47:56 - stock_prediction - INFO - 
XGBoost Top 10特征重要性:
2025-11-05 09:47:56 - stock_prediction - INFO -   price_position: 0.0353
2025-11-05 09:47:56 - stock_prediction - INFO -   volume: 0.0330
2025-11-05 09:47:56 - stock_prediction - INFO -   high: 0.0325
2025-11-05 09:47:56 - stock_prediction - INFO -   alpha006: 0.0301
2025-11-05 09:47:56 - stock_prediction - INFO -   alpha020: 0.0299
2025-11-05 09:47:56 - stock_prediction - INFO -   alpha022: 0.0298
2025-11-05 09:47:56 - stock_prediction - INFO -   alpha101: 0.0293
2025-11-05 09:47:56 - stock_prediction - INFO -   alpha003: 0.0293
2025-11-05 09:47:56 - stock_prediction - INFO -   volume_rank: 0.0290
2025-11-05 09:47:56 - stock_prediction - INFO -   market_cap_rank: 0.0288
2025-11-05 09:47:56 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:47:56 - stock_prediction - INFO - 【步骤5】模型集成
2025-11-05 09:47:56 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:47:56 - stock_prediction - INFO - 已添加2个模型到集成器
2025-11-05 09:47:56 - stock_prediction - INFO - 
集成模型验证集评估:
2025-11-05 09:47:56 - stock_prediction - INFO - 集成模型性能指标:
2025-11-05 09:47:56 - stock_prediction - INFO -   MSE: 0.0004940569500073473
2025-11-05 09:47:56 - stock_prediction - INFO -   RMSE: 0.022227391884954636
2025-11-05 09:47:56 - stock_prediction - INFO -   MAE: 0.014566422308793361
2025-11-05 09:47:56 - stock_prediction - INFO -   Correlation: 0.07793570175570819
2025-11-05 09:47:56 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:47:56 - stock_prediction - INFO - 【步骤6】测试集预测
2025-11-05 09:47:56 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:47:57 - stock_prediction - INFO - 测试集大小: (405626, 37)
2025-11-05 09:47:57 - stock_prediction - INFO - 测试集日期范围: 2020-01-02 15:00:00 至 2023-11-15 15:00:00
2025-11-05 09:47:57 - stock_prediction - INFO - 开始预测...
2025-11-05 09:47:57 - stock_prediction - INFO - 预测值统计: 均值=-0.000136, 标准差=0.001460
2025-11-05 09:47:57 - stock_prediction - INFO - 预测值范围: [-0.035574, 0.057410]
2025-11-05 09:47:58 - stock_prediction - INFO - 预测结果已保存到: predictions.csv
2025-11-05 09:47:58 - stock_prediction - INFO - 预测样本数: 405626
2025-11-05 09:47:58 - stock_prediction - INFO - 预测结果统计:
2025-11-05 09:47:58 - stock_prediction - INFO -   预测样本数: 405626
2025-11-05 09:47:58 - stock_prediction - INFO -   预测股票数: 524
2025-11-05 09:47:58 - stock_prediction - INFO -   预测日期数: 938
2025-11-05 09:47:58 - stock_prediction - INFO -   预测值均值: -0.00013603789470674151
2025-11-05 09:47:58 - stock_prediction - INFO -   预测值标准差: 0.0014599616861913087
2025-11-05 09:47:58 - stock_prediction - INFO -   预测值最小值: -0.03557409215756406
2025-11-05 09:47:58 - stock_prediction - INFO -   预测值最大值: 0.05740971804130331
2025-11-05 09:47:58 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:47:58 - stock_prediction - INFO - 【步骤7】保存模型
2025-11-05 09:47:58 - stock_prediction - INFO - --------------------------------------------------------------------------------
2025-11-05 09:47:58 - stock_prediction - INFO - LightGBM模型已保存到: models/lgb_model.pkl
2025-11-05 09:47:58 - stock_prediction - INFO - XGBoost模型已保存到: models/xgb_model.pkl
2025-11-05 09:47:58 - stock_prediction - INFO - 特征列表已保存到: models/feature_list.pkl
2025-11-05 09:47:58 - stock_prediction - INFO - 运行摘要已保存到: logs/run_summary.json
2025-11-05 09:47:58 - stock_prediction - INFO - ================================================================================
2025-11-05 09:47:58 - stock_prediction - INFO - 【步骤8】结果总结
2025-11-05 09:47:58 - stock_prediction - INFO - ================================================================================
2025-11-05 09:47:58 - stock_prediction - INFO - 
模型性能对比:
2025-11-05 09:47:58 - stock_prediction - INFO -   LightGBM Correlation: 0.072968
2025-11-05 09:47:58 - stock_prediction - INFO -   XGBoost Correlation: 0.074937
2025-11-05 09:47:58 - stock_prediction - INFO -   Ensemble Correlation: 0.077936
2025-11-05 09:47:58 - stock_prediction - INFO - 
最佳模型: Ensemble
2025-11-05 09:47:58 - stock_prediction - INFO - 
结束时间: 2025-11-05 09:47:58
2025-11-05 09:47:58 - stock_prediction - INFO - ================================================================================
2025-11-05 09:47:58 - stock_prediction - INFO - 项目完成!
2025-11-05 09:47:58 - stock_prediction - INFO - ================================================================================
2025-11-05 09:47:58 - stock_prediction - INFO - 
详细日志已保存到: logs/stock_prediction_20251105_094524.log
正在加载数据: daily_data.csv
尝试直接加载...
直接加载失败: 'utf-8' codec can't decode byte 0x8b in position 0: invalid start byte
尝试使用latin1编码...
数据加载完成，共 953712 条记录（latin1编码）
警告: 发现 20 行日期无效，将被移除
数据预处理完成
训练集: 547698 条记录 (截止 2019-12-31)
测试集: 405626 条记录 (从 2020-01-01 开始)
开始生成技术指标特征...
技术指标特征生成完成
开始生成Alpha101因子...
正在计算 alpha001...
正在计算 alpha002...
正在计算 alpha003...
正在计算 alpha004...
正在计算 alpha005...
正在计算 alpha006...
正在计算 alpha007...
正在计算 alpha008...
正在计算 alpha009...
正在计算 alpha010...
正在计算 alpha011...
正在计算 alpha012...
正在计算 alpha013...
正在计算 alpha014...
正在计算 alpha015...
正在计算 alpha016...
正在计算 alpha017...
正在计算 alpha018...
正在计算 alpha019...
正在计算 alpha020...
正在计算 alpha021...
正在计算 alpha022...
正在计算 alpha023...
正在计算 alpha024...
正在计算 alpha025...
正在计算 alpha026...
正在计算 alpha101...
Alpha因子生成完成，共 27 个因子
所有特征生成完成，共 63 列
开始生成技术指标特征...
技术指标特征生成完成
开始生成Alpha101因子...
正在计算 alpha001...
正在计算 alpha002...
正在计算 alpha003...
正在计算 alpha004...
正在计算 alpha005...
正在计算 alpha006...
正在计算 alpha007...
正在计算 alpha008...
正在计算 alpha009...
正在计算 alpha010...
正在计算 alpha011...
正在计算 alpha012...
正在计算 alpha013...
正在计算 alpha014...
正在计算 alpha015...
正在计算 alpha016...
正在计算 alpha017...
正在计算 alpha018...
正在计算 alpha019...
正在计算 alpha020...
正在计算 alpha021...
正在计算 alpha022...
正在计算 alpha023...
正在计算 alpha024...
正在计算 alpha025...
正在计算 alpha026...
正在计算 alpha101...
Alpha因子生成完成，共 27 个因子
所有特征生成完成，共 63 列
移除低方差特征后，剩余 46 个特征
移除高相关性特征后，剩余 37 个特征
根据correlation选择了 37 个特征
开始训练 lightgbm 模型...
训练集大小: (438158, 37)
Training until validation scores don't improve for 50 rounds
Early stopping, best iteration is:
[72]	valid_0's rmse: 0.0222358
模型训练完成

模型评估结果:
MSE: 0.000494
RMSE: 0.022236
MAE: 0.014573
Correlation: 0.072968

特征重要性 (Top 20):
               feature  importance
3          momentum_20         127
30      price_position         121
1           momentum_5         100
22            alpha009          94
2             alpha011          87
4          momentum_10          86
27            alpha101          85
17  turnover_rate_rank          83
34                high          83
25            alpha020          83
11            alpha001          67
36            alpha012          65
0             alpha005          63
9             alpha023          62
8             alpha016          58
19            alpha010          57
31         volume_rank          55
14            alpha015          54
26     market_cap_rank          53
6             alpha013          49
开始训练 xgboost 模型...
训练集大小: (438158, 37)
模型训练完成

模型评估结果:
MSE: 0.000494
RMSE: 0.022232
MAE: 0.014570
Correlation: 0.074937

特征重要性 (Top 20):
               feature  importance
30      price_position    0.035268
35              volume    0.032965
34                high    0.032510
21            alpha006    0.030071
25            alpha020    0.029859
32            alpha022    0.029795
27            alpha101    0.029302
23            alpha003    0.029273
31         volume_rank    0.029039
26     market_cap_rank    0.028769
8             alpha016    0.028768
17  turnover_rate_rank    0.028626
24            alpha017    0.027872
22            alpha009    0.027483
19            alpha010    0.027275
13            alpha018    0.027266
6             alpha013    0.027047
11            alpha001    0.027009
1           momentum_5    0.026997
28            alpha025    0.026791

集成模型评估结果 (average):
MSE: 0.000494
RMSE: 0.022227
MAE: 0.014566
Correlation: 0.077936
模型已保存到: models/lgb_model.pkl
模型已保存到: models/xgb_model.pkl
